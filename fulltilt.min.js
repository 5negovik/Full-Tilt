// FULL TILT JS / http://github.com/richtr/Full-Tilt-JS
(function(e){function y(e){e=+e;if(e===0||isNaN(e))return e;return e>0?1:-1}function w(){if(c){h=(e.screen.orientation.angle||0)*i}else{h=(e.orientation||0)*i}}function E(e){f=e;for(var t in u){u[t].call(this)}}function S(e){l=e;for(var t in a){a[t].call(this)}}if(e.FULLTILT!==undefined&&e.FULLTILT!==null){return}var t=Math.PI;var n=t/2;var r=2*t;var i=t/180;var s=180/t;var o=false;motionActive=false,screenActive=false;var u=[],a=[];var f={},l={};var c=e.screen&&e.screen.orientation&&e.screen.orientation.angle!==undefined&&e.screen.orientation.angle!==null?true:false;var h=(c?e.screen.orientation.angle:e.orientation||0)*i;var p=0,d=n,v=t,m=r/3,g=-n;var b={};b.Quaternion=function(e,t,n,r){var s,o;this.set=function(e,t,n,r){this.x=e||0;this.y=t||0;this.z=n||0;this.w=r||1};this.copy=function(e){this.x=e.x;this.y=e.y;this.z=e.z;this.w=e.w};this.setFromEuler=function(){var e,t,n;var r,s,o;var u,a,f,l,c,h;return function(p){p=p||{};n=(p.alpha||0)*i;e=(p.beta||0)*i;t=(p.gamma||0)*i;o=n/2;r=e/2;s=t/2;u=Math.cos(r);a=Math.cos(s);f=Math.cos(o);l=Math.sin(r);c=Math.sin(s);h=Math.sin(o);this.set(l*a*f-u*c*h,u*c*f+l*a*h,u*a*h+l*c*f,u*a*f-l*c*h);this.normalize();return this}}();this.setFromRotationMatrix=function(){var e;return function(t){e=t.elements;this.set(.5*Math.sqrt(1+e[0]-e[4]-e[8])*y(e[7]-e[5]),.5*Math.sqrt(1-e[0]+e[4]-e[8])*y(e[2]-e[6]),.5*Math.sqrt(1-e[0]-e[4]+e[8])*y(e[3]-e[1]),.5*Math.sqrt(1+e[0]+e[4]+e[8]));return this}}();this.multiply=function(e){o=b.Quaternion.prototype.multiplyQuaternions(this,e);this.copy(o);return this};this.rotateX=function(e){o=b.Quaternion.prototype.rotateByAxisAngle(this,[1,0,0],e);this.copy(o);return this};this.rotateY=function(e){o=b.Quaternion.prototype.rotateByAxisAngle(this,[0,1,0],e);this.copy(o);return this};this.rotateZ=function(e){o=b.Quaternion.prototype.rotateByAxisAngle(this,[0,0,1],e);this.copy(o);return this};this.normalize=function(){return b.Quaternion.prototype.normalize(this)};this.set(e,t,n,r)};b.Quaternion.prototype={constructor:b.Quaternion,multiplyQuaternions:function(){var e=new b.Quaternion;return function(t,n){var r=t.x,i=t.y,s=t.z,o=t.w;var u=n.x,a=n.y,f=n.z,l=n.w;e.set(r*l+o*u+i*f-s*a,i*l+o*a+s*u-r*f,s*l+o*f+r*a-i*u,o*l-r*u-i*a-s*f);return e}}(),normalize:function(e){var t=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w);if(t===0){e.x=0;e.y=0;e.z=0;e.w=1}else{t=1/t;e.x*=t;e.y*=t;e.z*=t;e.w*=t}return e},rotateByAxisAngle:function(){var e=new b.Quaternion;var t=new b.Quaternion;var n,r;return function(i,s,o){n=(o||0)/2;r=Math.sin(n);t.set((s[0]||0)*r,(s[1]||0)*r,(s[2]||0)*r,Math.cos(n));e=b.Quaternion.prototype.multiplyQuaternions(i,t);return b.Quaternion.prototype.normalize(e)}}()};b.RotationMatrix=function(e,t,n,r,s,o,u,a,f){var l;this.elements=new Float32Array(9);this.identity=function(){this.set(1,0,0,0,1,0,0,0,1);return this};this.set=function(e,t,n,r,i,s,o,u,a){this.elements[0]=e||1;this.elements[1]=t||0;this.elements[2]=n||0;this.elements[3]=r||0;this.elements[4]=i||1;this.elements[5]=s||0;this.elements[6]=o||0;this.elements[7]=u||0;this.elements[8]=a||1};this.copy=function(e){this.elements[0]=e.elements[0];this.elements[1]=e.elements[1];this.elements[2]=e.elements[2];this.elements[3]=e.elements[3];this.elements[4]=e.elements[4];this.elements[5]=e.elements[5];this.elements[6]=e.elements[6];this.elements[7]=e.elements[7];this.elements[8]=e.elements[8]};this.setFromEuler=function(){var e,t,n;var r,s,o,u,a,f;return function(l){l=l||{};n=(l.alpha||0)*i;e=(l.beta||0)*i;t=(l.gamma||0)*i;r=Math.cos(e);s=Math.cos(t);o=Math.cos(n);u=Math.sin(e);a=Math.sin(t);f=Math.sin(n);this.set(o*s-f*u*a,-r*f,s*f*u+o*a,s*f+o*u*a,o*r,f*a-o*s*u,-r*a,u,r*s);this.normalize();return this}}();this.setFromQuaternion=function(){var e,t,n,r;return function(i){e=i.w*i.w;t=i.x*i.x;n=i.y*i.y;r=i.z*i.z;this.set(e+t-n-r,2*(i.x*i.y-i.w*i.z),2*(i.x*i.z+i.w*i.y),2*(i.x*i.y+i.w*i.z),e-t+n-r,2*(i.y*i.z-i.w*i.x),2*(i.x*i.z-i.w*i.y),2*(i.y*i.z+i.w*i.x),e-t-n+r);return this}}();this.multiply=function(e){l=b.RotationMatrix.prototype.multiplyMatrices(this,e);this.copy(l);return this};this.rotateX=function(e){l=b.RotationMatrix.prototype.rotateByAxisAngle(this,[1,0,0],e);this.copy(l);return this};this.rotateY=function(e){l=b.RotationMatrix.prototype.rotateByAxisAngle(this,[0,1,0],e);this.copy(l);return this};this.rotateZ=function(e){l=b.RotationMatrix.prototype.rotateByAxisAngle(this,[0,0,1],e);this.copy(l);return this};this.normalize=function(){return b.RotationMatrix.prototype.normalize(this)};this.set(e,t,n,r,s,o,u,a,f)};b.RotationMatrix.prototype={constructor:b.RotationMatrix,multiplyMatrices:function(){var e=new b.RotationMatrix;var t,n;return function(r,i){t=r.elements;n=i.elements;e.set(t[0]*n[0]+t[1]*n[3]+t[2]*n[6],t[0]*n[1]+t[1]*n[4]+t[2]*n[7],t[0]*n[2]+t[1]*n[5]+t[2]*n[8],t[3]*n[0]+t[4]*n[3]+t[5]*n[6],t[3]*n[1]+t[4]*n[4]+t[5]*n[7],t[3]*n[2]+t[4]*n[5]+t[5]*n[8],t[6]*n[0]+t[7]*n[3]+t[8]*n[6],t[6]*n[1]+t[7]*n[4]+t[8]*n[7],t[6]*n[2]+t[7]*n[5]+t[8]*n[8]);return e}}(),normalize:function(e){var t=e.elements;var n=t[0]*t[4]*t[8]-t[0]*t[5]*t[7]-t[1]*t[3]*t[8]+t[1]*t[5]*t[6]+t[2]*t[3]*t[7]-t[2]*t[4]*t[6];t[0]/=n;t[1]/=n;t[2]/=n;t[3]/=n;t[4]/=n;t[5]/=n;t[6]/=n;t[7]/=n;t[8]/=n;e.elements=t;return e},rotateByAxisAngle:function(){var e=new b.RotationMatrix;var t=new b.RotationMatrix;var n,r;var i=false;return function(s,o,u){t.identity();i=false;n=Math.sin(u);r=Math.cos(u);if(o[0]===1&&o[1]===0&&o[2]===0){i=true;t.elements[4]=r;t.elements[5]=-n;t.elements[7]=n;t.elements[8]=r}else if(o[1]===1&&o[0]===0&&o[2]===0){i=true;t.elements[0]=r;t.elements[2]=n;t.elements[6]=-n;t.elements[8]=r}else if(o[2]===1&&o[0]===0&&o[1]===0){i=true;t.elements[0]=r;t.elements[1]=-n;t.elements[3]=n;t.elements[4]=r}if(i){e=b.RotationMatrix.prototype.multiplyMatrices(s,t);e=b.RotationMatrix.prototype.normalize(e)}else{e=s}return e}}()};b.Euler=function(e,i,o){this.set=function(e,t,n){this.alpha=e||0;this.beta=t||0;this.gamma=n||0};this.copy=function(e){this.alpha=e.alpha;this.beta=e.beta;this.gamma=e.gamma};this.setFromRotationMatrix=function(){var e,i,o,u;return function(a){e=a.elements;if(e[8]>0){i=Math.atan2(-e[1],e[4]);o=Math.asin(e[7]);u=Math.atan2(-e[6],e[8])}else if(e[8]<0){i=Math.atan2(e[1],-e[4]);o=-Math.asin(e[7]);o+=o>=0?-t:t;u=Math.atan2(e[6],-e[8])}else{if(e[6]>0){i=Math.atan2(-e[1],e[4]);o=Math.asin(e[7]);u=-n}else if(e[6]<0){i=Math.atan2(e[1],-e[4]);o=-Math.asin(e[7]);o+=o>=0?-t:t;u=-n}else{i=Math.atan2(e[3],e[0]);o=e[7]>0?n:-n;u=0}}if(i<0){i+=r}i*=s;o*=s;u*=s;this.set(i,o,u)}}();this.setFromQuaternion=function(){var e,i,o;return function(u){var a=u.w*u.w;var f=u.x*u.x;var l=u.y*u.y;var c=u.z*u.z;var h=a+f+l+c;var p=u.w*u.x+u.y*u.z;var d=1e-6;if(p>(.5-d)*h){e=2*Math.atan2(u.y,u.w);i=n;o=0}else if(p<(-.5+d)*h){e=-2*Math.atan2(u.y,u.w);i=-n;o=0}else{var v=a-f-l+c;if(v>0){e=Math.atan2(2*(u.w*u.z-u.x*u.y),a-f+l-c);i=Math.asin(2*p/h);o=Math.atan2(2*(u.w*u.y-u.x*u.z),v)}else{e=Math.atan2(-2*(u.w*u.z-u.x*u.y),-(a-f+l-c));i=-Math.asin(2*p/h);i+=i<0?t:-t;o=Math.atan2(-2*(u.w*u.y-u.x*u.z),-v)}}if(e<0){e+=r}e*=s;i*=s;o*=s;this.set(e,i,o)}}();this.rotateX=function(e){b.Euler.prototype.rotateByAxisAngle(this,[1,0,0],e);return this};this.rotateY=function(e){b.Euler.prototype.rotateByAxisAngle(this,[0,1,0],e);return this};this.rotateZ=function(e){b.Euler.prototype.rotateByAxisAngle(this,[0,0,1],e);return this};this.set(e,i,o)};b.Euler.prototype={constructor:b.Euler,rotateByAxisAngle:function(){var e=new b.RotationMatrix;var t;return function(t,n,r){e.setFromEuler(t);e=b.RotationMatrix.prototype.rotateByAxisAngle(e,n,r);t.setFromRotationMatrix(e);return t}}()};var x=function(){};x.prototype={constructor:x,start:function(t){if(t&&Object.prototype.toString.call(t)=="[object Function]"){u.push(t)}if(!screenActive){if(c){e.screen.orientation.addEventListener("change",w,false)}else{e.addEventListener("orientationchange",w,false)}}if(!o){e.addEventListener("deviceorientation",E,false);o=true}},stop:function(){if(o){e.removeEventListener("deviceorientation",E,false);o=false}},getFixedFrameQuaternion:function(){var e=new b.Quaternion;return function(){e.setFromEuler(f);return e}}(),getScreenAdjustedQuaternion:function(){var e;return function(){e=x.prototype.getFixedFrameQuaternion();e.rotateZ(-h);return e}}(),getFixedFrameMatrix:function(){var e=new b.RotationMatrix;return function(){e.setFromEuler(f);return e}}(),getScreenAdjustedMatrix:function(){var e;return function(){e=x.prototype.getFixedFrameMatrix();e.rotateZ(-h);return e}}(),getFixedFrameEuler:function(){var e=new b.Euler;var t;return function(){t=x.prototype.getFixedFrameMatrix();e.setFromRotationMatrix(t);return e}}(),getScreenAdjustedEuler:function(){var e=new b.Euler;var t;return function(){t=x.prototype.getScreenAdjustedMatrix();e.setFromRotationMatrix(t);return e}}(),isAbsolute:function(){if(f&&f.absolute===true){return true}return false},getLastRawEventData:function(){return f}};var T=function(){};T.prototype={constructor:T,start:function(t){if(t&&Object.prototype.toString.call(t)=="[object Function]"){a.push(t)}if(!screenActive){if(c){e.screen.orientation.addEventListener("change",w,false)}else{e.addEventListener("orientationchange",w,false)}}if(!motionActive){e.addEventListener("devicemotion",S,false);motionActive=true}},stop:function(){if(motionActive){e.removeEventListener("devicemotion",S,false);motionActive=false}},getScreenAdjustedAcceleration:function(){var e=l.acceleration||{};var t={};switch(h){case d:t.x=-e.y;t.y=e.x;break;case v:t.x=-e.x;t.y=-e.y;break;case m:case g:t.x=e.y;t.y=-e.x;break;default:t.x=e.x;t.y=e.y;break}t.z=e.z;return t},getScreenAdjustedAccelerationIncludingGravity:function(){var e=l.accelerationIncludingGravity||{};var t={};switch(h){case d:t.x=-e.y;t.y=e.x;break;case v:t.x=-e.x;t.y=-e.y;break;case m:case g:t.x=e.y;t.y=-e.x;break;default:t.x=e.x;t.y=e.y;break}t.z=e.z;return t},getScreenAdjustedRotationRate:function(){var e=l.rotationRate||{};var t={};switch(h){case d:t.beta=-e.gamma;t.gamma=e.beta;break;case v:t.beta=-e.beta;t.gamma=-e.gamma;break;case m:case g:t.beta=e.gamma;t.gamma=-e.beta;break;default:t.beta=e.beta;t.gamma=e.gamma;break}t.alpha=e.alpha;return t},getLastRawEventData:function(){return l}};b.DeviceOrientation=new x;b.DeviceMotion=new T;e.FULLTILT=b})(window)
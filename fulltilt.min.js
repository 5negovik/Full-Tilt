// FULL TILT JS / http://github.com/richtr/Full-Tilt-JS
(function(e){function c(){if(i){s=(e.screen.orientation.angle||0)*t}else{s=(e.orientation||0)*t}}function h(e){o=e}if(e.FULLTILT!==undefined&&e.FULLTILT!==null){return}var t=Math.PI/180;var n=180/Math.PI;var r=false;var i=e.screen&&e.screen.orientation&&e.screen.orientation.angle!==undefined&&e.screen.orientation.angle!==null?true:false;var s=(i?e.screen.orientation.angle:e.orientation||0)*t;var o={};var u={};u.Quaternion=function(e,t,n,r){var i,s;this.set=function(e,t,n,r){this.x=e||0;this.y=t||0;this.z=n||0;this.w=r||1};this.copy=function(e){this.x=e.x;this.y=e.y;this.z=e.z;this.w=e.w};this.multiply=function(e){s=u.Quaternion.prototype.multiplyQuaternions(this,e);this.copy(s);return this};this.rotateX=function(e){s=u.Quaternion.prototype.rotateByAxisAngle(this,[1,0,0],e);this.copy(s);return this};this.rotateY=function(e){s=u.Quaternion.prototype.rotateByAxisAngle(this,[0,1,0],e);this.copy(s);return this};this.rotateZ=function(e){s=u.Quaternion.prototype.rotateByAxisAngle(this,[0,0,1],e);this.copy(s);return this};this.set(e,t,n,r)};u.Quaternion.prototype={constructor:u.Quaternion,multiplyQuaternions:function(){var e=new u.Quaternion;return function(t,n){var r=t.x,i=t.y,s=t.z,o=t.w;var u=n.x,a=n.y,f=n.z,l=n.w;e.set(r*l+o*u+i*f-s*a,i*l+o*a+s*u-r*f,s*l+o*f+r*a-i*u,o*l-r*u-i*a-s*f);return e}}(),normalize:function(e){var t=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w);if(t===0){e.x=0;e.y=0;e.z=0;e.w=1}else{t=1/t;e.x*=t;e.y*=t;e.z*=t;e.w*=t}return e},rotateByAxisAngle:function(){var e=new u.Quaternion;var t=new u.Quaternion;var n,r;return function(i,s,o){n=(o||0)/2;r=Math.sin(n);t.set((s[0]||0)*r,(s[1]||0)*r,(s[2]||0)*r,Math.cos(n));e=u.Quaternion.prototype.multiplyQuaternions(i,t);return u.Quaternion.prototype.normalize(e)}}()};u.RotationMatrix=function(e,t,n,r,i,s,o,a,f){var l;this.elements=new Float32Array(9);this.identity=function(){this.set(1,0,0,0,1,0,0,0,1);return this};this.set=function(e,t,n,r,i,s,o,u,a){this.elements[0]=e||1;this.elements[1]=t||0;this.elements[2]=n||0;this.elements[3]=r||0;this.elements[4]=i||1;this.elements[5]=s||0;this.elements[6]=o||0;this.elements[7]=u||0;this.elements[8]=a||1};this.copy=function(e){this.elements[0]=e.elements[0];this.elements[1]=e.elements[1];this.elements[2]=e.elements[2];this.elements[3]=e.elements[3];this.elements[4]=e.elements[4];this.elements[5]=e.elements[5];this.elements[6]=e.elements[6];this.elements[7]=e.elements[7];this.elements[8]=e.elements[8]};this.multiply=function(e){l=u.RotationMatrix.prototype.multiplyMatrices(this,e);this.copy(l);return this};this.rotateX=function(e){l=u.RotationMatrix.prototype.rotateByAxisAngle(this,[1,0,0],e);this.copy(l);return this};this.rotateY=function(e){l=u.RotationMatrix.prototype.rotateByAxisAngle(this,[0,1,0],e);this.copy(l);return this};this.rotateZ=function(e){l=u.RotationMatrix.prototype.rotateByAxisAngle(this,[0,0,1],e);this.copy(l);return this};this.set(e,t,n,r,i,s,o,a,f)};u.RotationMatrix.prototype={constructor:u.RotationMatrix,multiplyMatrices:function(){var e=new u.RotationMatrix;var t,n;return function(r,i){t=r.elements;n=i.elements;e.set(t[0]*n[0]+t[1]*n[3]+t[2]*n[6],t[0]*n[1]+t[1]*n[4]+t[2]*n[7],t[0]*n[2]+t[1]*n[5]+t[2]*n[8],t[3]*n[0]+t[4]*n[3]+t[5]*n[6],t[3]*n[1]+t[4]*n[4]+t[5]*n[7],t[3]*n[2]+t[4]*n[5]+t[5]*n[8],t[6]*n[0]+t[7]*n[3]+t[8]*n[6],t[6]*n[1]+t[7]*n[4]+t[8]*n[7],t[6]*n[2]+t[7]*n[5]+t[8]*n[8]);return e}}(),normalize:function(e){var t=e.elements;var n=t[0]*t[4]*t[8]-t[0]*t[5]*t[7]-t[1]*t[3]*t[8]+t[1]*t[5]*t[6]+t[2]*t[3]*t[7]-t[2]*t[4]*t[6];t[0]/=n;t[1]/=n;t[2]/=n;t[3]/=n;t[4]/=n;t[5]/=n;t[6]/=n;t[7]/=n;t[8]/=n;e.elements=t;return e},rotateByAxisAngle:function(){var e=new u.RotationMatrix;var t=new u.RotationMatrix;var n,r;var i=false;return function(s,o,a){t.identity();i=false;n=Math.sin(a);r=Math.cos(a);if(o[0]===1&&o[1]===0&&o[2]===0){i=true;t.elements[4]=r;t.elements[5]=-n;t.elements[7]=n;t.elements[8]=r}else if(o[1]===1&&o[0]===0&&o[2]===0){i=true;t.elements[0]=r;t.elements[2]=n;t.elements[6]=-n;t.elements[8]=r}else if(o[2]===1&&o[0]===0&&o[1]===0){i=true;t.elements[0]=r;t.elements[1]=-n;t.elements[3]=n;t.elements[4]=r}if(i){e=u.RotationMatrix.prototype.multiplyMatrices(s,t);e=u.RotationMatrix.prototype.normalize(e)}else{e=s}return e}}()};u.Euler=function(e,t,n){this.set=function(e,t,n){this.alpha=e||0;this.beta=t||0;this.gamma=n||0};this.copy=function(e){this.alpha=e.alpha;this.beta=e.beta;this.gamma=e.gamma};this.rotateX=function(e){u.Euler.prototype.rotateByAxisAngle(this,[1,0,0],e);return this};this.rotateY=function(e){u.Euler.prototype.rotateByAxisAngle(this,[0,1,0],e);return this};this.rotateZ=function(e){u.Euler.prototype.rotateByAxisAngle(this,[0,0,1],e);return this};this.set(e,t,n)};u.Euler.prototype={constructor:u.Euler,rotateByAxisAngle:function(){var e,t;return function(n,r,i){e=f(n.beta,n.gamma,n.alpha);e=u.RotationMatrix.prototype.rotateByAxisAngle(e,r,i);t=u.Euler.prototype.setFromRotationMatrix(e);n.copy(t);return n}}(),setFromRotationMatrix:function(){var e=new u.Euler;var t,r,i,s;return function(o){t=o.elements;if(t[8]>0){r=Math.atan2(-t[1],t[4]);i=Math.asin(t[7]);s=Math.atan2(-t[6],t[8])}else if(t[8]<0){r=Math.atan2(t[1],-t[4]);i=-Math.asin(t[7]);i+=i>=0?-Math.PI:Math.PI;s=Math.atan2(t[6],-t[8])}else{if(t[6]>0){r=Math.atan2(-t[1],t[4]);i=Math.asin(t[7]);s=-Math.PI/2}else if(t[6]<0){r=Math.atan2(t[1],-t[4]);i=-Math.asin(t[7]);i+=i>=0?-Math.PI:Math.PI;s=-Math.PI/2}else{r=Math.atan2(t[3],t[0]);i=t[7]>0?Math.PI/2:-Math.PI/2;s=0}}if(r<0){r+=2*Math.PI}r*=n;i*=n;s*=n;e.set(r,i,s);return e}}()};var a=function(){var e=new u.Quaternion;var n,r,i;var s,o,a;var f,l,c,h,p,d;return function(v,m,g){i=(g||0)*t;n=(v||0)*t;r=(m||0)*t;a=i/2;s=n/2;o=r/2;f=Math.cos(s);l=Math.cos(o);c=Math.cos(a);h=Math.sin(s);p=Math.sin(o);d=Math.sin(a);e.set(h*l*c-f*p*d,f*p*c+h*l*d,f*l*d+h*p*c,f*l*c-h*p*d);e=u.Quaternion.prototype.normalize(e);return e}}();var f=function(){var e=new u.RotationMatrix;var n,r,i;var s,o,a,f,l,c;return function(h,p,d){i=(d||0)*t;n=(h||0)*t;r=(p||0)*t;s=Math.cos(n);o=Math.cos(r);a=Math.cos(i);f=Math.sin(n);l=Math.sin(r);c=Math.sin(i);e.set(a*o-c*f*l,-s*c,o*c*f+a*l,o*c+a*f*l,a*s,c*l-a*o*f,-s*l,f,s*o);e=u.RotationMatrix.prototype.normalize(e);return e}}();var l=function(){var e=new u.Euler;var t,n;return function(r,i,s){n=f(r,i,s);t=u.Euler.prototype.setFromRotationMatrix(n);e.copy(t);return e}}();var p=function(){};p.prototype={constructor:p,start:function(){if(!r){if(i){e.screen.orientation.addEventListener("change",c,false)}else{e.addEventListener("orientationchange",c,false)}e.addEventListener("deviceorientation",h,false);r=true}},stop:function(){if(r){if(i){e.screen.orientation.removeEventListener("change",c,false)}else{e.removeEventListener("orientationchange",c,false)}e.removeEventListener("deviceorientation",h,false);r=false}},getDeviceQuaternion:function(){var e=a(o.beta,o.gamma,o.alpha);e.rotateZ(-s);return e},getDeviceRotation:function(){var e=f(o.beta,o.gamma,o.alpha);e.rotateZ(-s);return e},getDeviceEuler:function(){var e=l(o.beta,o.gamma,o.alpha);e.rotateZ(-s);return e},isAbsolute:function(){if(o&&o.absolute===true){return true}return false},getRawDeviceOrientationData:function(){return o}};u.DeviceOrientation=new p;e.FULLTILT=u})(window)
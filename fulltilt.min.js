// FULL TILT JS / http://github.com/richtr/Full-Tilt-JS
(function(e){function b(){if(a){f=(e.screen.orientation.angle||0)*t}else{f=(e.orientation||0)*t}}function w(e){o=e;for(var t in i){i[t].call(this)}}function E(e){u=e;for(var t in s){s[t].call(this)}}if(e.FULLTILT!==undefined&&e.FULLTILT!==null){return}var t=Math.PI/180;var n=180/Math.PI;var r=false;motionActive=false,screenActive=false;var i=[],s=[];var o={},u={};var a=e.screen&&e.screen.orientation&&e.screen.orientation.angle!==undefined&&e.screen.orientation.angle!==null?true:false;var f=(a?e.screen.orientation.angle:e.orientation||0)*t;var l=0,c=Math.PI/2,h=Math.PI,p=2*Math.PI/3,d=-Math.PI/2;var v={};v.Quaternion=function(e,t,n,r){var i,s;this.set=function(e,t,n,r){this.x=e||0;this.y=t||0;this.z=n||0;this.w=r||1};this.copy=function(e){this.x=e.x;this.y=e.y;this.z=e.z;this.w=e.w};this.multiply=function(e){s=v.Quaternion.prototype.multiplyQuaternions(this,e);this.copy(s);return this};this.rotateX=function(e){s=v.Quaternion.prototype.rotateByAxisAngle(this,[1,0,0],e);this.copy(s);return this};this.rotateY=function(e){s=v.Quaternion.prototype.rotateByAxisAngle(this,[0,1,0],e);this.copy(s);return this};this.rotateZ=function(e){s=v.Quaternion.prototype.rotateByAxisAngle(this,[0,0,1],e);this.copy(s);return this};this.set(e,t,n,r)};v.Quaternion.prototype={constructor:v.Quaternion,multiplyQuaternions:function(){var e=new v.Quaternion;return function(t,n){var r=t.x,i=t.y,s=t.z,o=t.w;var u=n.x,a=n.y,f=n.z,l=n.w;e.set(r*l+o*u+i*f-s*a,i*l+o*a+s*u-r*f,s*l+o*f+r*a-i*u,o*l-r*u-i*a-s*f);return e}}(),normalize:function(e){var t=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w);if(t===0){e.x=0;e.y=0;e.z=0;e.w=1}else{t=1/t;e.x*=t;e.y*=t;e.z*=t;e.w*=t}return e},rotateByAxisAngle:function(){var e=new v.Quaternion;var t=new v.Quaternion;var n,r;return function(i,s,o){n=(o||0)/2;r=Math.sin(n);t.set((s[0]||0)*r,(s[1]||0)*r,(s[2]||0)*r,Math.cos(n));e=v.Quaternion.prototype.multiplyQuaternions(i,t);return v.Quaternion.prototype.normalize(e)}}()};v.RotationMatrix=function(e,t,n,r,i,s,o,u,a){var f;this.elements=new Float32Array(9);this.identity=function(){this.set(1,0,0,0,1,0,0,0,1);return this};this.set=function(e,t,n,r,i,s,o,u,a){this.elements[0]=e||1;this.elements[1]=t||0;this.elements[2]=n||0;this.elements[3]=r||0;this.elements[4]=i||1;this.elements[5]=s||0;this.elements[6]=o||0;this.elements[7]=u||0;this.elements[8]=a||1};this.copy=function(e){this.elements[0]=e.elements[0];this.elements[1]=e.elements[1];this.elements[2]=e.elements[2];this.elements[3]=e.elements[3];this.elements[4]=e.elements[4];this.elements[5]=e.elements[5];this.elements[6]=e.elements[6];this.elements[7]=e.elements[7];this.elements[8]=e.elements[8]};this.multiply=function(e){f=v.RotationMatrix.prototype.multiplyMatrices(this,e);this.copy(f);return this};this.rotateX=function(e){f=v.RotationMatrix.prototype.rotateByAxisAngle(this,[1,0,0],e);this.copy(f);return this};this.rotateY=function(e){f=v.RotationMatrix.prototype.rotateByAxisAngle(this,[0,1,0],e);this.copy(f);return this};this.rotateZ=function(e){f=v.RotationMatrix.prototype.rotateByAxisAngle(this,[0,0,1],e);this.copy(f);return this};this.set(e,t,n,r,i,s,o,u,a)};v.RotationMatrix.prototype={constructor:v.RotationMatrix,multiplyMatrices:function(){var e=new v.RotationMatrix;var t,n;return function(r,i){t=r.elements;n=i.elements;e.set(t[0]*n[0]+t[1]*n[3]+t[2]*n[6],t[0]*n[1]+t[1]*n[4]+t[2]*n[7],t[0]*n[2]+t[1]*n[5]+t[2]*n[8],t[3]*n[0]+t[4]*n[3]+t[5]*n[6],t[3]*n[1]+t[4]*n[4]+t[5]*n[7],t[3]*n[2]+t[4]*n[5]+t[5]*n[8],t[6]*n[0]+t[7]*n[3]+t[8]*n[6],t[6]*n[1]+t[7]*n[4]+t[8]*n[7],t[6]*n[2]+t[7]*n[5]+t[8]*n[8]);return e}}(),normalize:function(e){var t=e.elements;var n=t[0]*t[4]*t[8]-t[0]*t[5]*t[7]-t[1]*t[3]*t[8]+t[1]*t[5]*t[6]+t[2]*t[3]*t[7]-t[2]*t[4]*t[6];t[0]/=n;t[1]/=n;t[2]/=n;t[3]/=n;t[4]/=n;t[5]/=n;t[6]/=n;t[7]/=n;t[8]/=n;e.elements=t;return e},rotateByAxisAngle:function(){var e=new v.RotationMatrix;var t=new v.RotationMatrix;var n,r;var i=false;return function(s,o,u){t.identity();i=false;n=Math.sin(u);r=Math.cos(u);if(o[0]===1&&o[1]===0&&o[2]===0){i=true;t.elements[4]=r;t.elements[5]=-n;t.elements[7]=n;t.elements[8]=r}else if(o[1]===1&&o[0]===0&&o[2]===0){i=true;t.elements[0]=r;t.elements[2]=n;t.elements[6]=-n;t.elements[8]=r}else if(o[2]===1&&o[0]===0&&o[1]===0){i=true;t.elements[0]=r;t.elements[1]=-n;t.elements[3]=n;t.elements[4]=r}if(i){e=v.RotationMatrix.prototype.multiplyMatrices(s,t);e=v.RotationMatrix.prototype.normalize(e)}else{e=s}return e}}()};v.Euler=function(e,t,n){this.set=function(e,t,n){this.alpha=e||0;this.beta=t||0;this.gamma=n||0};this.copy=function(e){this.alpha=e.alpha;this.beta=e.beta;this.gamma=e.gamma};this.rotateX=function(e){v.Euler.prototype.rotateByAxisAngle(this,[1,0,0],e);return this};this.rotateY=function(e){v.Euler.prototype.rotateByAxisAngle(this,[0,1,0],e);return this};this.rotateZ=function(e){v.Euler.prototype.rotateByAxisAngle(this,[0,0,1],e);return this};this.set(e,t,n)};v.Euler.prototype={constructor:v.Euler,rotateByAxisAngle:function(){var e,t;return function(n,r,i){e=g(n.beta,n.gamma,n.alpha);e=v.RotationMatrix.prototype.rotateByAxisAngle(e,r,i);t=v.Euler.prototype.setFromRotationMatrix(e);n.copy(t);return n}}(),setFromRotationMatrix:function(){var e=new v.Euler;var t,r,i,s;return function(o){t=o.elements;if(t[8]>0){r=Math.atan2(-t[1],t[4]);i=Math.asin(t[7]);s=Math.atan2(-t[6],t[8])}else if(t[8]<0){r=Math.atan2(t[1],-t[4]);i=-Math.asin(t[7]);i+=i>=0?-Math.PI:Math.PI;s=Math.atan2(t[6],-t[8])}else{if(t[6]>0){r=Math.atan2(-t[1],t[4]);i=Math.asin(t[7]);s=-Math.PI/2}else if(t[6]<0){r=Math.atan2(t[1],-t[4]);i=-Math.asin(t[7]);i+=i>=0?-Math.PI:Math.PI;s=-Math.PI/2}else{r=Math.atan2(t[3],t[0]);i=t[7]>0?Math.PI/2:-Math.PI/2;s=0}}if(r<0){r+=2*Math.PI}r*=n;i*=n;s*=n;e.set(r,i,s);return e}}()};var m=function(){var e=new v.Quaternion;var n,r,i;var s,o,u;var a,f,l,c,h,p;return function(d,m,g){i=(g||0)*t;n=(d||0)*t;r=(m||0)*t;u=i/2;s=n/2;o=r/2;a=Math.cos(s);f=Math.cos(o);l=Math.cos(u);c=Math.sin(s);h=Math.sin(o);p=Math.sin(u);e.set(c*f*l-a*h*p,a*h*l+c*f*p,a*f*p+c*h*l,a*f*l-c*h*p);e=v.Quaternion.prototype.normalize(e);return e}}();var g=function(){var e=new v.RotationMatrix;var n,r,i;var s,o,u,a,f,l;return function(c,h,p){i=(p||0)*t;n=(c||0)*t;r=(h||0)*t;s=Math.cos(n);o=Math.cos(r);u=Math.cos(i);a=Math.sin(n);f=Math.sin(r);l=Math.sin(i);e.set(u*o-l*a*f,-s*l,o*l*a+u*f,o*l+u*a*f,u*s,l*f-u*o*a,-s*f,a,s*o);e=v.RotationMatrix.prototype.normalize(e);return e}}();var y=function(){var e=new v.Euler;var t,n;return function(r,i,s){n=g(r,i,s);t=v.Euler.prototype.setFromRotationMatrix(n);e.copy(t);return e}}();var S=function(){};S.prototype={constructor:S,start:function(t){if(t&&Object.prototype.toString.call(t)=="[object Function]"){i.push(t)}if(!screenActive){if(a){e.screen.orientation.addEventListener("change",b,false)}else{e.addEventListener("orientationchange",b,false)}}if(!r){e.addEventListener("deviceorientation",w,false);r=true}},stop:function(){if(r){e.removeEventListener("deviceorientation",w,false);r=false}},getDeviceQuaternion:function(){var e=m(o.beta,o.gamma,o.alpha);e.rotateZ(-f);return e},getDeviceRotation:function(){var e=g(o.beta,o.gamma,o.alpha);e.rotateZ(-f);return e},getDeviceEuler:function(){var e=y(o.beta,o.gamma,o.alpha);e.rotateZ(-f);return e},isAbsolute:function(){if(o&&o.absolute===true){return true}return false},getRawDeviceOrientationData:function(){return o}};var x=function(){};x.prototype={constructor:x,start:function(t){if(t&&Object.prototype.toString.call(t)=="[object Function]"){s.push(t)}if(!screenActive){if(a){e.screen.orientation.addEventListener("change",b,false)}else{e.addEventListener("orientationchange",b,false)}}if(!motionActive){e.addEventListener("devicemotion",E,false);motionActive=true}},stop:function(){if(motionActive){e.removeEventListener("devicemotion",E,false);motionActive=false}},getDeviceAcceleration:function(){var e=u.acceleration||{};var t={};switch(f){case c:t.x=-e.y;t.y=e.x;break;case h:t.x=-e.x;t.y=-e.y;break;case p:case d:t.x=e.y;t.y=-e.x;break;default:t.x=e.x;t.y=e.y;break}t.z=e.z;return t},getDeviceAccelerationIncludingGravity:function(){var e=u.accelerationIncludingGravity||{};var t={};switch(f){case c:t.x=-e.y;t.y=e.x;break;case h:t.x=-e.x;t.y=-e.y;break;case p:case d:t.x=e.y;t.y=-e.x;break;default:t.x=e.x;t.y=e.y;break}t.z=e.z;return t},getDeviceRotationRate:function(){var e=u.rotationRate||{};var t={};switch(f){case c:t.beta=-e.gamma;t.gamma=e.beta;break;case h:t.beta=-e.beta;t.gamma=-e.gamma;break;case p:case d:t.beta=e.gamma;t.gamma=-e.beta;break;default:t.beta=e.beta;t.gamma=e.gamma;break}t.alpha=e.alpha;return t},getRawDeviceMotionData:function(){return u}};v.DeviceOrientation=new S;v.DeviceMotion=new x;e.FULLTILT=v})(window)
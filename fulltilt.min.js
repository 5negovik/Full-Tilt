// FULL TILT JS / http://github.com/richtr/Full-Tilt-JS
(function(e){function v(e){e=+e;if(e===0||isNaN(e))return e;return e>0?1:-1}function g(){if(a){f=(e.screen.orientation.angle||0)*t}else{f=(e.orientation||0)*t}}function y(e){o=e;for(var t in i){i[t].call(this)}}function b(e){u=e;for(var t in s){s[t].call(this)}}if(e.FULLTILT!==undefined&&e.FULLTILT!==null){return}var t=Math.PI/180;var n=180/Math.PI;var r=false;motionActive=false,screenActive=false;var i=[],s=[];var o={},u={};var a=e.screen&&e.screen.orientation&&e.screen.orientation.angle!==undefined&&e.screen.orientation.angle!==null?true:false;var f=(a?e.screen.orientation.angle:e.orientation||0)*t;var l=0,c=Math.PI/2,h=Math.PI,p=2*Math.PI/3,d=-Math.PI/2;var m={};m.Quaternion=function(e,n,r,i){var s,o;this.set=function(e,t,n,r){this.x=e||0;this.y=t||0;this.z=n||0;this.w=r||1};this.copy=function(e){this.x=e.x;this.y=e.y;this.z=e.z;this.w=e.w};this.setFromEuler=function(){var e,n,r;var i,s,o;var u,a,f,l,c,h;return function(p,d,v){r=(v||0)*t;e=(p||0)*t;n=(d||0)*t;o=r/2;i=e/2;s=n/2;u=Math.cos(i);a=Math.cos(s);f=Math.cos(o);l=Math.sin(i);c=Math.sin(s);h=Math.sin(o);this.set(l*a*f-u*c*h,u*c*f+l*a*h,u*a*h+l*c*f,u*a*f-l*c*h);this.normalize();return this}}();this.setFromRotationMatrix=function(){var e;return function(t){e=t.elements;this.set(.5*Math.sqrt(1+e[0]-e[4]-e[8])*v(e[7]-e[5]),.5*Math.sqrt(1-e[0]+e[4]-e[8])*v(e[2]-e[6]),.5*Math.sqrt(1-e[0]-e[4]+e[8])*v(e[3]-e[1]),.5*Math.sqrt(1+e[0]+e[4]+e[8]));return this}}();this.multiply=function(e){o=m.Quaternion.prototype.multiplyQuaternions(this,e);this.copy(o);return this};this.rotateX=function(e){o=m.Quaternion.prototype.rotateByAxisAngle(this,[1,0,0],e);this.copy(o);return this};this.rotateY=function(e){o=m.Quaternion.prototype.rotateByAxisAngle(this,[0,1,0],e);this.copy(o);return this};this.rotateZ=function(e){o=m.Quaternion.prototype.rotateByAxisAngle(this,[0,0,1],e);this.copy(o);return this};this.normalize=function(){return m.Quaternion.prototype.normalize(this)};this.set(e,n,r,i)};m.Quaternion.prototype={constructor:m.Quaternion,multiplyQuaternions:function(){var e=new m.Quaternion;return function(t,n){var r=t.x,i=t.y,s=t.z,o=t.w;var u=n.x,a=n.y,f=n.z,l=n.w;e.set(r*l+o*u+i*f-s*a,i*l+o*a+s*u-r*f,s*l+o*f+r*a-i*u,o*l-r*u-i*a-s*f);return e}}(),normalize:function(e){var t=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w);if(t===0){e.x=0;e.y=0;e.z=0;e.w=1}else{t=1/t;e.x*=t;e.y*=t;e.z*=t;e.w*=t}return e},rotateByAxisAngle:function(){var e=new m.Quaternion;var t=new m.Quaternion;var n,r;return function(i,s,o){n=(o||0)/2;r=Math.sin(n);t.set((s[0]||0)*r,(s[1]||0)*r,(s[2]||0)*r,Math.cos(n));e=m.Quaternion.prototype.multiplyQuaternions(i,t);return m.Quaternion.prototype.normalize(e)}}()};m.RotationMatrix=function(e,n,r,i,s,o,u,a,f){var l;this.elements=new Float32Array(9);this.identity=function(){this.set(1,0,0,0,1,0,0,0,1);return this};this.set=function(e,t,n,r,i,s,o,u,a){this.elements[0]=e||1;this.elements[1]=t||0;this.elements[2]=n||0;this.elements[3]=r||0;this.elements[4]=i||1;this.elements[5]=s||0;this.elements[6]=o||0;this.elements[7]=u||0;this.elements[8]=a||1};this.copy=function(e){this.elements[0]=e.elements[0];this.elements[1]=e.elements[1];this.elements[2]=e.elements[2];this.elements[3]=e.elements[3];this.elements[4]=e.elements[4];this.elements[5]=e.elements[5];this.elements[6]=e.elements[6];this.elements[7]=e.elements[7];this.elements[8]=e.elements[8]};this.setFromEuler=function(){var e,n,r;var i,s,o,u,a,f;return function(l,c,h){r=(h||0)*t;e=(l||0)*t;n=(c||0)*t;i=Math.cos(e);s=Math.cos(n);o=Math.cos(r);u=Math.sin(e);a=Math.sin(n);f=Math.sin(r);this.set(o*s-f*u*a,-i*f,s*f*u+o*a,s*f+o*u*a,o*i,f*a-o*s*u,-i*a,u,i*s);this.normalize();return this}}();this.setFromQuaternion=function(){var e,t,n,r;return function(i){e=i.w*i.w;t=i.x*i.x;n=i.y*i.y;r=i.z*i.z;this.set(e+t-n-r,2*(i.x*i.y-i.w*i.z),2*(i.x*i.z+i.w*i.y),2*(i.x*i.y+i.w*i.z),e-t+n-r,2*(i.y*i.z-i.w*i.x),2*(i.x*i.z-i.w*i.y),2*(i.y*i.z+i.w*i.x),e-t-n+r);return this}}();this.multiply=function(e){l=m.RotationMatrix.prototype.multiplyMatrices(this,e);this.copy(l);return this};this.rotateX=function(e){l=m.RotationMatrix.prototype.rotateByAxisAngle(this,[1,0,0],e);this.copy(l);return this};this.rotateY=function(e){l=m.RotationMatrix.prototype.rotateByAxisAngle(this,[0,1,0],e);this.copy(l);return this};this.rotateZ=function(e){l=m.RotationMatrix.prototype.rotateByAxisAngle(this,[0,0,1],e);this.copy(l);return this};this.normalize=function(){return m.RotationMatrix.prototype.normalize(this)};this.set(e,n,r,i,s,o,u,a,f)};m.RotationMatrix.prototype={constructor:m.RotationMatrix,multiplyMatrices:function(){var e=new m.RotationMatrix;var t,n;return function(r,i){t=r.elements;n=i.elements;e.set(t[0]*n[0]+t[1]*n[3]+t[2]*n[6],t[0]*n[1]+t[1]*n[4]+t[2]*n[7],t[0]*n[2]+t[1]*n[5]+t[2]*n[8],t[3]*n[0]+t[4]*n[3]+t[5]*n[6],t[3]*n[1]+t[4]*n[4]+t[5]*n[7],t[3]*n[2]+t[4]*n[5]+t[5]*n[8],t[6]*n[0]+t[7]*n[3]+t[8]*n[6],t[6]*n[1]+t[7]*n[4]+t[8]*n[7],t[6]*n[2]+t[7]*n[5]+t[8]*n[8]);return e}}(),normalize:function(e){var t=e.elements;var n=t[0]*t[4]*t[8]-t[0]*t[5]*t[7]-t[1]*t[3]*t[8]+t[1]*t[5]*t[6]+t[2]*t[3]*t[7]-t[2]*t[4]*t[6];t[0]/=n;t[1]/=n;t[2]/=n;t[3]/=n;t[4]/=n;t[5]/=n;t[6]/=n;t[7]/=n;t[8]/=n;e.elements=t;return e},rotateByAxisAngle:function(){var e=new m.RotationMatrix;var t=new m.RotationMatrix;var n,r;var i=false;return function(s,o,u){t.identity();i=false;n=Math.sin(u);r=Math.cos(u);if(o[0]===1&&o[1]===0&&o[2]===0){i=true;t.elements[4]=r;t.elements[5]=-n;t.elements[7]=n;t.elements[8]=r}else if(o[1]===1&&o[0]===0&&o[2]===0){i=true;t.elements[0]=r;t.elements[2]=n;t.elements[6]=-n;t.elements[8]=r}else if(o[2]===1&&o[0]===0&&o[1]===0){i=true;t.elements[0]=r;t.elements[1]=-n;t.elements[3]=n;t.elements[4]=r}if(i){e=m.RotationMatrix.prototype.multiplyMatrices(s,t);e=m.RotationMatrix.prototype.normalize(e)}else{e=s}return e}}()};m.Euler=function(e,t,r){this.set=function(e,t,n){this.alpha=e||0;this.beta=t||0;this.gamma=n||0};this.copy=function(e){this.alpha=e.alpha;this.beta=e.beta;this.gamma=e.gamma};this.setFromRotationMatrix=function(){var e,t,r,i;return function(s){e=s.elements;if(e[8]>0){t=Math.atan2(-e[1],e[4]);r=Math.asin(e[7]);i=Math.atan2(-e[6],e[8])}else if(e[8]<0){t=Math.atan2(e[1],-e[4]);r=-Math.asin(e[7]);r+=r>=0?-Math.PI:Math.PI;i=Math.atan2(e[6],-e[8])}else{if(e[6]>0){t=Math.atan2(-e[1],e[4]);r=Math.asin(e[7]);i=-Math.PI/2}else if(e[6]<0){t=Math.atan2(e[1],-e[4]);r=-Math.asin(e[7]);r+=r>=0?-Math.PI:Math.PI;i=-Math.PI/2}else{t=Math.atan2(e[3],e[0]);r=e[7]>0?Math.PI/2:-Math.PI/2;i=0}}if(t<0){t+=2*Math.PI}t*=n;r*=n;i*=n;this.set(t,r,i)}}();this.setFromQuaternion=function(){var e,t,r;return function(i){var s=i.w*i.w;var o=i.x*i.x;var u=i.y*i.y;var a=i.z*i.z;var f=s+o+u+a;var l=i.w*i.x+i.y*i.z;var c=1e-4;if(l>(.5-c)*f){e=2*Math.atan2(i.y,i.w);t=Math.PI;r=0}else if(l<(-.5+c)*f){e=-2*Math.atan2(i.y,i.w);t=-Math.PI;r=0}else{var h=i.w*i.z-i.x*i.y;var p=i.w*i.y-i.x*i.z;e=Math.atan2(2*h,1-2*(a+o));t=Math.asin(2*l/f);r=Math.atan2(2*p,1-2*(u+o))}if(e<0){e+=2*Math.PI}e*=n;t*=n;r*=n;this.set(e,t,r)}}();this.rotateX=function(e){m.Euler.prototype.rotateByAxisAngle(this,[1,0,0],e);return this};this.rotateY=function(e){m.Euler.prototype.rotateByAxisAngle(this,[0,1,0],e);return this};this.rotateZ=function(e){m.Euler.prototype.rotateByAxisAngle(this,[0,0,1],e);return this};this.set(e,t,r)};m.Euler.prototype={constructor:m.Euler,rotateByAxisAngle:function(){var e=new m.RotationMatrix;var t;return function(t,n,r){e.setFromEuler(t.beta,t.gamma,t.alpha);e=m.RotationMatrix.prototype.rotateByAxisAngle(e,n,r);t.setFromRotationMatrix(e);return t}}()};var w=function(){};w.prototype={constructor:w,start:function(t){if(t&&Object.prototype.toString.call(t)=="[object Function]"){i.push(t)}if(!screenActive){if(a){e.screen.orientation.addEventListener("change",g,false)}else{e.addEventListener("orientationchange",g,false)}}if(!r){e.addEventListener("deviceorientation",y,false);r=true}},stop:function(){if(r){e.removeEventListener("deviceorientation",y,false);r=false}},getFixedFrameQuaternion:function(){var e=new m.Quaternion;return function(){e.setFromEuler(o.beta,o.gamma,o.alpha);return e}}(),getScreenAdjustedQuaternion:function(){var e;return function(){e=w.prototype.getFixedFrameQuaternion();e.rotateZ(-f);return e}}(),getFixedFrameMatrix:function(){var e=new m.RotationMatrix;return function(){e.setFromEuler(o.beta,o.gamma,o.alpha);return e}}(),getScreenAdjustedMatrix:function(){var e;return function(){e=w.prototype.getFixedFrameMatrix();e.rotateZ(-f);return e}}(),getFixedFrameEuler:function(){var e=new m.Euler;var t=new m.RotationMatrix;return function(){t=w.prototype.getFixedFrameMatrix();e.setFromRotationMatrix(t);return e}}(),getScreenAdjustedEuler:function(){var e=new m.Euler;return function(){var t=w.prototype.getScreenAdjustedMatrix();e.setFromRotationMatrix(t);return e}}(),isAbsolute:function(){if(o&&o.absolute===true){return true}return false},getLastRawEventData:function(){return o}};var E=function(){};E.prototype={constructor:E,start:function(t){if(t&&Object.prototype.toString.call(t)=="[object Function]"){s.push(t)}if(!screenActive){if(a){e.screen.orientation.addEventListener("change",g,false)}else{e.addEventListener("orientationchange",g,false)}}if(!motionActive){e.addEventListener("devicemotion",b,false);motionActive=true}},stop:function(){if(motionActive){e.removeEventListener("devicemotion",b,false);motionActive=false}},getScreenAdjustedAcceleration:function(){var e=u.acceleration||{};var t={};switch(f){case c:t.x=-e.y;t.y=e.x;break;case h:t.x=-e.x;t.y=-e.y;break;case p:case d:t.x=e.y;t.y=-e.x;break;default:t.x=e.x;t.y=e.y;break}t.z=e.z;return t},getScreenAdjustedAccelerationIncludingGravity:function(){var e=u.accelerationIncludingGravity||{};var t={};switch(f){case c:t.x=-e.y;t.y=e.x;break;case h:t.x=-e.x;t.y=-e.y;break;case p:case d:t.x=e.y;t.y=-e.x;break;default:t.x=e.x;t.y=e.y;break}t.z=e.z;return t},getScreenAdjustedRotationRate:function(){var e=u.rotationRate||{};var t={};switch(f){case c:t.beta=-e.gamma;t.gamma=e.beta;break;case h:t.beta=-e.beta;t.gamma=-e.gamma;break;case p:case d:t.beta=e.gamma;t.gamma=-e.beta;break;default:t.beta=e.beta;t.gamma=e.gamma;break}t.alpha=e.alpha;return t},getLastRawEventData:function(){return u}};m.DeviceOrientation=new w;m.DeviceMotion=new E;e.FULLTILT=m})(window)